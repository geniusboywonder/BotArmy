{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Product Generator Agent Handoff Schema",
  "description": "Schema for handoffs between AI agents in the Product Generator system.",
  "type": "object",
  "properties": {
    "handoff_id": {
      "type": "string",
      "format": "uuid",
      "description": "Unique ID for this handoff."
    },
    "from_agent": {
      "type": "string",
      "description": "Name of the agent sending the handoff."
    },
    "to_agent": {
      "type": "string",
      "description": "Name of the agent receiving the handoff."
    },
    "handoff_type": {
      "type": "string",
      "description": "Type/category of this handoff."
    },
    "version": {
      "type": "string",
      "description": "Schema or handoff version.",
      "default": "1.0"
    },
    "status": {
      "type": "string",
      "enum": [
        "ok",
        "fail",
        "waiting_for_input"
      ],
      "description": "Status of this handoff."
    },
    "human_input_reason": {
      "type": [
        "string",
        "null"
      ],
      "description": "Reason for human intervention, if status is 'waiting_for_input'."
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of when this handoff was created."
    },
    "dependencies": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "List of handoff IDs that this handoff depends on."
    },
    "content": {
      "type": "object",
      "description": "Main payload for this handoff. Structure depends on handoff_type."
    },
    "product_spec": {
      "type": "object",
      "description": "Current snapshot of the living product specification.",
      "properties": {
        "functional_requirements": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "non_functional_requirements": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "constraints": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "design_docs": {
          "type": "array",
          "items": {
            "type": "string",
            "format": "uri"
          }
        },
        "decisions_log": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "timestamp": {
                "type": "string",
                "format": "date-time"
              },
              "from_agent": {
                "type": "string"
              },
              "to_agent": {
                "type": "string"
              },
              "decision": {
                "type": "string"
              }
            },
            "required": [
              "timestamp",
              "from_agent",
              "to_agent",
              "decision"
            ]
          }
        }
      },
      "required": [
        "functional_requirements",
        "non_functional_requirements",
        "constraints",
        "decisions_log"
      ]
    }
  },
  "required": [
    "handoff_id",
    "from_agent",
    "to_agent",
    "handoff_type",
    "version",
    "status",
    "timestamp",
    "content"
  ]
}